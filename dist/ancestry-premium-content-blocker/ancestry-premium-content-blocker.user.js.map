{
  "version": 3,
  "sources": ["../../src/main/ancestry-premium-content-blocker/ancestry-premium-content-blocker.user.ts"],
  "sourcesContent": ["namespace AncestryPremiumContentBlocker {\n  const CACHE_NAME = 'ancestry-link-cache'\n  const CACHE_DURATION = 3 * 24 * 60 * 60 * 1000 // 3 days in milliseconds\n  const SIGNUP_INDICATORS = ['/account/signin', '/secure/login', 'subscribe', 'membership', 'cs/offers']\n\n  interface CachedResponse {\n    url: string\n    isSignupPage: boolean\n    timestamp: number\n  }\n\n  // Check if a URL points to a signup page\n  const isSignupPage = (url: string, content: string): boolean => {\n    return SIGNUP_INDICATORS.some(indicator => url.toLowerCase().includes(indicator) || content.toLowerCase().includes(indicator))\n  }\n\n  // Get cached result for a URL\n  const getCachedResult = async (url: string): Promise<CachedResponse | null> => {\n    try {\n      const cache = await caches.open(CACHE_NAME)\n      const response = await cache.match(url)\n\n      if (!response) {\n        return null\n      }\n\n      const data: CachedResponse = await response.json()\n\n      // Check if cache is expired\n      if (Date.now() - data.timestamp > CACHE_DURATION) {\n        await cache.delete(url)\n        return null\n      }\n      return data\n    } catch (e) {\n      console.error('Error reading cache:', e)\n      return null\n    }\n  }\n\n  // Save result to cache\n  const cacheResult = async (url: string, isSignup: boolean): Promise<void> => {\n    try {\n      const cache = await caches.open(CACHE_NAME)\n      const data: CachedResponse = {\n        url,\n        isSignupPage: isSignup,\n        timestamp: Date.now(),\n      }\n\n      const response = new Response(JSON.stringify(data), {\n        headers: { 'Content-Type': 'application/json' },\n      })\n      await cache.put(url, response)\n    } catch (e) {\n      console.error('Error writing to cache:', e)\n    }\n  }\n\n  // Preload and check a single link\n  const checkLink = async (link: HTMLAnchorElement): Promise<void> => {\n    const url = link.href\n\n    // Skip non-HTTP links and external links\n    if (!url.startsWith('http') || !url.includes('ancestry.com')) {\n      return\n    }\n\n    // Check cache first\n    const cached = await getCachedResult(url)\n    if (cached) {\n      if (cached.isSignupPage) {\n        disableLink(link)\n      }\n      return\n    }\n\n    // Fetch the URL\n    try {\n      const response = await fetch(url, {\n        method: 'HEAD',\n        redirect: 'follow',\n        credentials: 'include',\n      })\n\n      const finalUrl = response.url\n      const isSignup = isSignupPage(finalUrl, '')\n\n      // If HEAD request shows signup, verify with GET for content check\n      if (!isSignup && response.ok) {\n        const fullResponse = await fetch(url, {\n          redirect: 'follow',\n          credentials: 'include',\n        })\n        const text = await fullResponse.text()\n        const isSignupContent = isSignupPage(fullResponse.url, text)\n        await cacheResult(url, isSignupContent)\n        if (isSignupContent) {\n          disableLink(link)\n        }\n      } else {\n        await cacheResult(url, isSignup)\n\n        if (isSignup) {\n          disableLink(link)\n        }\n      }\n    } catch (e) {\n      console.error(`Error checking link ${url}:`, e)\n    }\n  }\n\n  // Disable a link visually and functionally\n  const disableLink = (link: HTMLAnchorElement): void => {\n    link.style.opacity = '0.5'\n    link.style.cursor = 'not-allowed'\n    link.style.textDecoration = 'line-through'\n    link.style.pointerEvents = 'none'\n    link.title = 'This link requires a subscription'\n\n    // Prevent all click events\n    link.addEventListener(\n      'click',\n      e => {\n        e.preventDefault()\n        e.stopPropagation()\n      },\n      true,\n    )\n\n    // Add a visual indicator\n    if (!link.querySelector('.signup-indicator')) {\n      const indicator = document.createElement('span')\n      indicator.className = 'signup-indicator'\n      indicator.textContent = ' ðŸ”’'\n      indicator.style.fontSize = '0.8em'\n      link.appendChild(indicator)\n    }\n  }\n\n  // Process all links on the page\n  const processLinks = async (): Promise<void> => {\n    const links = document.querySelectorAll<HTMLAnchorElement>('a[href]')\n    console.log(`Processing ${links.length} links on page`)\n\n    // Process links with rate limiting to avoid overwhelming the server\n    const batchSize = 5\n    for (let i = 0; i < links.length; i += batchSize) {\n      const batch = Array.from(links).slice(i, i + batchSize)\n      await Promise.all(batch.map(link => checkLink(link)))\n\n      // Small delay between batches\n      await new Promise(resolve => setTimeout(resolve, 100))\n    }\n    console.log('Finished processing links')\n  }\n\n  const processNode = (node: Node): void => {\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const element = node as Element\n\n      // Check if the node itself is a link\n      if (element.tagName === 'A') {\n        checkLink(element as HTMLAnchorElement)\n      }\n      // Check for links within the node\n      const links = element.querySelectorAll('a[href]')\n      for (const link of links) {\n        checkLink(link as HTMLAnchorElement)\n      }\n    }\n  }\n\n  // Observer for dynamically added links\n  const observer = new MutationObserver(mutations => {\n    for (const mutation of mutations) {\n      for (const node of mutation.addedNodes) {\n        processNode(node)\n      }\n    }\n  })\n\n  // Initialize\n  export const init = async (): Promise<void> => {\n    console.log('Ancestry Link Checker initialized')\n\n    // Process existing links\n    await processLinks()\n\n    // Watch for new links\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n    })\n  }\n}\nAncestryPremiumContentBlocker.init()\n"],
  "mappings": "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",
  "names": ["AncestryPremiumContentBlocker"]
}
